# Token Dashboard 測試清單

## 測試環境
- URL: http://localhost:5175/
- 開發模式：使用模擬資料
- 瀏覽器：建議使用 Chrome/Edge（完整支援 Notification API）

---

## 📊 功能測試清單

### 1. 即時監控頁面 (RealTimeMonitor)

**路徑：** 首頁 / 即時監控

#### 測試項目：
- [ ] **統計卡片顯示**
  - 今日使用量卡片正常顯示（tokens + cost）
  - 本週使用量卡片正常顯示
  - 本月使用量卡片正常顯示
  - 本月成本卡片正常顯示

- [ ] **使用率進度條**
  - 進度條顯示本月使用百分比
  - 顏色正確（綠色 < 70%，黃色 70-80%，紅色 > 80%）
  - 顯示剩餘額度

- [ ] **詳細統計**
  - Token 使用明細（Input/Output/總計）
  - 平均統計（每次請求平均 tokens/成本/比例）

- [ ] **警示橫幅**（如果使用率 > 70%）
  - 黃色警告橫幅顯示（70-80%）
  - 紅色錯誤橫幅顯示（> 80%）
  - 可以關閉橫幅

**預期結果：** 所有數據正確顯示，進度條顏色依使用率變化

---

### 2. 使用量圖表頁面 (UsageChart)

**路徑：** 使用量圖表

#### 測試項目：
- [ ] **日期範圍選擇器**
  - 預設顯示最近 7 天
  - 可選擇自訂日期範圍
  - 選擇後圖表自動更新

- [ ] **時間序列圖表**（Tab 1）
  - 折線圖顯示每日使用量
  - X 軸顯示日期，Y 軸顯示 tokens
  - Hover 顯示 tooltip（日期 + tokens 數量）

- [ ] **Input vs Output 圖表**（Tab 2）
  - 堆疊柱狀圖顯示
  - Input tokens（藍色）+ Output tokens（綠色）
  - Hover 顯示各自數量

- [ ] **模型使用佔比**（Tab 3）
  - 左側圓餅圖：按 Token 數量
  - 右側圓餅圖：按成本
  - 顯示百分比與標籤

**預期結果：** 圖表正確渲染，互動順暢，數據準確

---

### 3. 歷史記錄頁面 (HistoryTable)

**路徑：** 歷史記錄

#### 測試項目：
- [ ] **表格顯示**
  - 顯示所有使用記錄
  - 欄位完整（時間、來源、模型、Input/Output/總計、成本、類型）
  - 預設按時間倒序排列

- [ ] **搜尋功能**
  - 輸入來源名稱可過濾（例：MAYOForm）
  - 輸入模型名稱可過濾（例：opus）
  - 清除搜尋恢復完整資料

- [ ] **排序功能**
  - 點擊「時間」欄位標題可排序
  - 點擊「成本」欄位標題可排序
  - 升序/降序切換正常

- [ ] **篩選功能**
  - 來源篩選器（點擊漏斗圖示）
  - 模型篩選器
  - 請求類型篩選器

- [ ] **分頁功能**
  - 預設每頁 20 筆
  - 可切換 10/20/50/100 筆
  - 頁碼切換正常
  - 顯示總筆數

- [ ] **匯出功能** ⭐
  - 點擊「匯出資料」按鈕
  - **匯出為 CSV**
    * 下載 CSV 檔案
    * 用 Excel/Google Sheets 開啟檢查
    * 確認標題列與資料完整
  - **匯出為 JSON**
    * 下載 JSON 檔案
    * 用文字編輯器開啟檢查格式
    * 確認包含 source_name 欄位
  - **匯出統計報告 (Markdown)**
    * 下載 .md 檔案
    * 檢查報告包含：總覽、按來源統計、按模型統計

**預期結果：** 表格功能完整，匯出檔案格式正確

---

### 4. 成本分析頁面 (CostAnalysis)

**路徑：** 成本分析

#### 測試項目：
- [ ] **成本統計卡片**
  - 本月總成本
  - 上月總成本
  - 成本變化（百分比 + 上升/下降圖示）
  - 預測下月成本

- [ ] **過去 30 天成本趨勢圖**
  - 折線圖顯示每日成本
  - Y 軸顯示美元符號
  - Hover 顯示日期與成本

- [ ] **各來源成本佔比**（左側圓餅圖）
  - 顯示各來源名稱與百分比
  - Hover 顯示成本金額

- [ ] **各模型成本佔比**（右側柱狀圖）
  - 顯示各模型名稱（簡化後）
  - Y 軸顯示成本

**預期結果：** 成本統計準確，圖表清晰易讀

---

### 5. 設定頁面

**路徑：** 設定

#### Tab 1: 警示設定 (AlertSettings) ⭐

##### 測試項目：
- [ ] **當前警示狀態橫幅**
  - 如果使用率 > 70%，顯示警告橫幅
  - 橫幅顏色正確（黃色警告/紅色錯誤）

- [ ] **警示設定表單**
  - 警示閾值百分比（預設 80）
    * 可修改 1-100 之間
    * 超出範圍顯示錯誤
  - 每日成本限額（預設 10）
    * 可修改數字（小數點 2 位）
  - 每月成本限額（預設 300）
    * 必填欄位，不能為空

- [ ] **桌面通知開關**
  - 切換開關可啟用/停用
  - 啟用時顯示「通知權限」說明框

- [ ] **通知權限測試** ⭐⭐
  - 點擊「請求通知權限」按鈕
  - 瀏覽器彈出通知權限請求
  - **允許通知**
    * 顯示測試通知「✅ 通知權限已啟用！」
    * 檢查系統通知中心是否收到
  - **拒絕通知**
    * 不會顯示通知

- [ ] **儲存設定**
  - 修改閾值後點擊「儲存設定」
  - 重新整理頁面，設定保持（Zustand persist）

- [ ] **重置為預設值**
  - 點擊「重置為預設值」按鈕
  - 所有欄位恢復初始值（80%, 10, 300）

- [ ] **使用說明**
  - 說明卡片顯示警示邏輯
  - 70% 閾值 = 黃色警告
  - 100% 閾值 = 紅色錯誤

**預期結果：** 設定可儲存，通知功能正常

#### Tab 2: 來源管理 (SourceManagement) ⭐

##### 測試項目：
- [ ] **來源列表**
  - 顯示所有來源（3 個預設來源）
  - 顯示名稱、描述、顏色、狀態

- [ ] **新增來源**
  - 點擊「新增來源」按鈕
  - 對話框彈出
  - 填寫資料：
    * 名稱：Test Source
    * 描述：測試用來源
    * 顏色：選擇任意顏色
    * 啟用：打開開關
  - 點擊「儲存」
  - **注意：** 目前僅 UI 測試，實際未儲存到資料庫

- [ ] **編輯來源**
  - 點擊任一來源的「編輯」按鈕
  - 對話框顯示現有資料
  - 修改名稱或顏色
  - 點擊「儲存」
  - 提示訊息顯示

- [ ] **刪除來源**
  - 點擊「刪除」按鈕
  - 確認對話框彈出
  - **警告：** 顯示「此操作無法復原」
  - 點擊「取消」→ 不刪除
  - 點擊「刪除」→ 提示已刪除
  - **注意：** 目前僅 UI 測試

- [ ] **顏色選擇器**
  - 點擊顏色欄位
  - ColorPicker 彈出
  - 選擇顏色後顯示更新

**預期結果：** 所有 CRUD 操作 UI 正常（實際 API 待實作）

---

### 6. 來源切換功能 ⭐⭐

**位置：** Header 右側

#### 測試項目：
- [ ] **來源選擇器顯示**
  - 下拉選單顯示「全部來源」+ 3 個來源
  - 每個來源有顏色標記

- [ ] **切換來源測試**
  - 選擇「MAYOForm-Web」
    * 即時監控數據更新（僅顯示該來源資料）
    * 圖表更新
    * 歷史記錄過濾
    * 成本分析更新
  - 選擇「Claude Code」
    * 所有頁面數據同步更新
  - 選擇「全部來源」
    * 顯示所有來源的資料

- [ ] **來源切換持久化**
  - 選擇特定來源
  - 重新整理頁面
  - 選擇狀態保持（Zustand persist）

**預期結果：** 來源切換影響所有頁面，狀態持久化

---

### 7. 警示通知測試 ⭐⭐⭐

**前置條件：** 允許瀏覽器通知權限

#### 測試項目：
- [ ] **調整閾值觸發警示**
  1. 前往「設定」→「警示設定」
  2. 將「每月成本限額」改為 **0.01** (非常小)
  3. 將「閾值百分比」改為 **1**
  4. 啟用「桌面通知」
  5. 點擊「儲存設定」
  6. 返回「即時監控」頁面

- [ ] **檢查警示橫幅**
  - 頁面頂部應顯示紅色錯誤橫幅
  - 訊息：「⚠️ 警告：本月 token 使用已達 xxx%」

- [ ] **檢查桌面通知**
  - 系統通知中心應收到通知
  - 標題：「Token Dashboard 警示」
  - 內容：警告訊息

- [ ] **通知去重測試**
  - 切換到其他頁面再回來
  - 不應重複發送通知（已通知過）

- [ ] **恢復正常閾值**
  - 設定改回：閾值 80%，限額 300
  - 警示橫幅消失

**預期結果：** 警示橫幅與通知正確觸發，去重機制有效

---

## 🔧 進階測試

### 8. 模擬資料驗證

- [ ] **資料一致性**
  - 即時監控的「本月總計」
  - = 歷史記錄表格中「本月資料」的加總
  - = 成本分析的「本月總成本」

- [ ] **資料範圍**
  - 歷史記錄應有約 1,500 筆（30 天 × 50 筆/天）
  - 最早記錄約在 30 天前
  - 最新記錄接近當前時間

### 9. 響應式測試

- [ ] **縮小瀏覽器視窗**
  - 卡片排列調整
  - 表格出現水平滾動
  - 圖表自適應寬度

### 10. 效能測試

- [ ] **頁面切換速度**
  - 各頁面切換流暢（< 1 秒）
  - 無明顯卡頓

- [ ] **資料載入**
  - 初次載入快速
  - React Query 快取生效（切換來源後不重複載入）

---

## 🐛 已知限制

### 目前僅 UI 測試（未連接 Supabase）
- ✅ 所有顯示功能正常
- ⚠️  新增/編輯/刪除來源僅顯示訊息，不實際儲存
- ⚠️  Realtime 訂閱已實作但無新資料

### Supabase 連接測試（可選）
如要測試真實資料庫：
1. 建立 Supabase 專案
2. 執行 `supabase/migrations/001_initial_schema.sql`
3. 建立 `.env` 檔案並填入憑證
4. 重新啟動 `pnpm dev`
5. 檢查 Console 是否顯示「✅ Realtime subscription active」

---

## ✅ 測試完成確認

完成以上測試後，確認：
- [ ] 所有核心功能正常運作
- [ ] 匯出功能可產生正確檔案
- [ ] 警示與通知系統有效
- [ ] 來源切換影響所有頁面
- [ ] 設定可正確儲存與恢復
- [ ] 無 Console 錯誤（除了預期的 Supabase 連線警告）

---

## 🎉 測試結果回報

請回報：
1. ✅ 通過的功能
2. ❌ 發現的問題（附截圖或錯誤訊息）
3. 💡 改進建議

測試愉快！🚀
